<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unfollowers Instagram Robot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Moo+Lah+Lah&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anonymous+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a60, #6a0572);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            text-align: center;
            padding: 20px;
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }
        .profile-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid white;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(255, 255, 255, 0.3);
            opacity: 1;
            transition: opacity 1s ease;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        .welcome-text {
            font-size: 2.8rem;
            font-weight: bold;
            font-family: 'Gochi Hand', cursive;
            max-width: 90%;
            margin-bottom: 10px;
            opacity: 1;
            transition: opacity 1s ease;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        .sub-text {
            font-size: 1.4rem;
            font-family: 'Gochi Hand', cursive;
            margin-bottom: 20px;
            max-width: 85%;
            opacity: 1;
            transition: opacity 1s ease;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        .page-description {
            font-size: 1rem;
            font-family: 'Kalam', serif;
            font-weight: 400;
            max-width: 600px;
            margin-bottom: 30px;
            line-height: 1.6;
            word-wrap: break-word;
            opacity: 1;
            transition: opacity 1s ease;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        .action-button {
            background-color: #ff8000;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s ease, opacity 1s ease;
            font-family: 'Moo Lah Lah', serif;
            font-weight: 400;
            margin-bottom: 30px;
            opacity: 1;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        .action-button:hover {
            background-color: #e67300;
        }
        .upload-instruction-text {
            font-size: 1.4rem;
            font-family: 'Kalam', serif;
            margin-bottom: 20px;
            max-width: 85%;
            line-height: 1.5;
            opacity: 0;
            transition: opacity 1s ease;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        .file-select-button {
            background-color: #ff8000;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s ease, opacity 1s ease;
            font-family: 'Moo Lah Lah', serif;
            font-weight: 400;
            opacity: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        .file-select-button:hover {
            background-color: #e67300;
        }
        .file-input {
            display: none;
        }
        .snowflake {
            position: absolute;
            top: -10px;
            color: white;
            opacity: 0.9;
            font-size: 1em;
            user-select: none;
            z-index: 1000;
            animation: fall linear infinite both;
        }
        @keyframes fall {
            0% { transform: translateY(-10px) translateX(0); }
            50% { transform: translateY(50vh) translateX(calc(5vw * var(--x))); }
            100% { transform: translateY(100vh) translateX(calc(10vw * var(--x))); }
        }
        .reset-button {
            font-family: "Anonymous Pro", serif;
            font-weight: 400;
            font-style: normal;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
            text-decoration: underline;
        }
        /* استایل‌های لودینگ */
        .dots-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001; /* بالاتر از بک‌گراند تاریک */
        }
        .dot {
            width: 15px;
            height: 15px;
            background-color: #ff8000; /* رنگ نارنجی */
            border-radius: 50%;
            margin: 0 5px;
            animation: bounce 1s infinite ease-in-out;
        }
        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        .dot:nth-child(4) {
            animation-delay: 0.6s;
        }
        .dot:nth-child(5) {
            animation-delay: 0.8s;
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        /* تاریک کردن بک‌گراند */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* تاریک کردن بک‌گراند */
            z-index: 1000; /* زیر لودینگ */
            display: none;
        }
        /* استایل ارور */
        .error {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            width: 320px;
            padding: 12px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: start;
            background: #EF665B;
            border-radius: 8px;
            box-shadow: 0px 0px 5px -3px #111;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1002;
            display: none;
        }
        .error__icon {
            width: 20px;
            height: 20px;
            transform: translateY(-2px);
            margin-right: 8px;
        }
        .error__icon path {
            fill: #fff;
        }
        .error__title {
            font-weight: 500;
            font-size: 14px;
            color: #fff;
        }
        .error__close {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-left: auto;
        }
        .error__close path {
            fill: #fff;
        }
        @media screen and (max-width: 768px) {
            .welcome-text {
                font-size: 2.2rem;
            }
            .sub-text {
                font-size: 1.2rem;
            }
            .page-description {
                font-size: 0.9rem;
            }
            .action-button, .file-select-button {
                font-size: 1rem;
                padding: 10px 20px;
            }
            .upload-instruction-text {
                font-size: 1.2rem;
            }
            .snowflake {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <main id="page1">
        <img src="https://raw.githubusercontent.com/BasirParvizi/inunfollowers/K/IN.jpg" alt="Profile Picture" class="profile-image">
        <h1 class="welcome-text">Welcome</h1>
        <p class="sub-text">to Unfollowers Instagram Robot<br>Support Page</p>
        <div class="page-description">
            We have created this page for iOS users.<br>
            So that you can enjoy our services just like other users.<br>
            Due to Apple's restrictions, we have to use this method.<br>
            Click the Continue button to proceed.
        </div>
        <button class="action-button" id="continueBtn">Continue</button>
        <button class="reset-button" id="resetBtn">Reset</button>
    </main>
    <section id="page2" style="display: none;">
        <h2 class="welcome-text">Upload File</h2>
        <p class="upload-instruction-text">Please upload the unfollowers.html file<br>that the Telegram bot sent you.</p>
        <label for="fileInput" class="file-select-button" id="fileButtonLabel">Select File</label>
        <input type="file" class="file-input" id="fileInput" accept=".html" />
    </section>
    <!-- لودینگ و تاریک کردن بک‌گراند -->
    <div id="loadingOverlay"></div>
    <section id="loadingSection" class="dots-container" style="display: none;">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
    </section>
    <!-- ارور -->
    <div class="error" id="error">
        <div class="error__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24" height="24" fill="none"><path fill="#393a37" d="m13 13h-2v-6h2zm0 4h-2v-2h2zm-1-15c-1.3132 0-2.61358.25866-3.82683.7612-1.21326.50255-2.31565 1.23915-3.24424 2.16773-1.87536 1.87537-2.92893 4.41891-2.92893 7.07107 0 2.6522 1.05357 5.1957 2.92893 7.0711.92859.9286 2.03098 1.6651 3.24424 2.1677 1.21325.5025 2.51363.7612 3.82683.7612 2.6522 0 5.1957-1.0536 7.0711-2.9289 1.8753-1.8754 2.9289-4.4189 2.9289-7.0711 0-1.3132-.2587-2.61358-.7612-3.82683-.5026-1.21326-1.2391-2.31565-2.1677-3.24424-.9286-.92858-2.031-1.66518-3.2443-2.16773-1.2132-.50254-2.5136-.7612-3.8268-.7612z"></path></svg>
        </div>
        <div class="error__title" id="errorMessage"></div>
        <div class="error__close" onclick="hideError()"><svg xmlns="http://www.w3.org/2000/svg" width="20" viewBox="0 0 20 20" height="20"><path fill="#393a37" d="m15.8333 5.34166-1.175-1.175-4.6583 4.65834-4.65833-4.65834-1.175 1.175 4.65833 4.65834-4.65833 4.6583 1.175 1.175 4.65833-4.6583 4.6583 4.6583 1.175-1.175-4.6583-4.6583z"></path></svg></div>
    </div>
    <script>
        const dbName = 'unfollowersDB';
        const storeName = 'files';
        const maxFileSize = 5 * 1024 * 1024; // 5 MB
    
        // اتصال به IndexedDB
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(dbName, 1);
    
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                request.onupgradeneeded = (event) => {
                    event.target.result.createObjectStore(storeName, { keyPath: 'id', autoIncrement: true });
                };
            });
        }
    
        // ذخیره فایل در IndexedDB
        async function saveFileToDB(content) {
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put({ content });
    
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    console.log('File saved to IndexedDB successfully.');
                    resolve();
                };
            });
        }
    
        // بارگذاری فایل از IndexedDB
        async function loadFileFromDB() {
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
    
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result[0]?.content || null);
            });
        }
    
        // پاک کردن فایل‌های ذخیره شده در IndexedDB
        async function resetDB() {
            const db = await openDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.clear();
    
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    console.log('IndexedDB cleared successfully.');
                    resolve();
                };
            });
        }
    
        // نمایش ارور
        function showError(message) {
            const error = document.getElementById('error');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            error.style.display = 'flex';
        }
    
        // مخفی کردن ارور
        function hideError() {
            const error = document.getElementById('error');
            error.style.display = 'none';
        }
    
        document.addEventListener('DOMContentLoaded', async function () {
            createSnowflakes(50);
    
            const continueBtn = document.getElementById('continueBtn');
            const resetBtn = document.getElementById('resetBtn');
            const page1 = document.getElementById('page1');
            const page2 = document.getElementById('page2');
            const fileInput = document.getElementById('fileInput');
            const fileButtonLabel = document.getElementById('fileButtonLabel');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingSection = document.getElementById('loadingSection');
    
            // رویداد کلیک بر روی دکمه Continue
            continueBtn.addEventListener('click', async function () {
                const savedContent = await loadFileFromDB();
                if (savedContent) {
                    showFile(savedContent);
                } else {
                    const elementsToFade = page1.querySelectorAll('.welcome-text, .sub-text, .page-description, .action-button');
                    elementsToFade.forEach(el => el.style.opacity = 0);
    
                    setTimeout(() => {
                        page1.style.display = 'none';
                        page2.style.display = 'block';
                        setTimeout(() => {
                            page2.querySelector('.upload-instruction-text').style.opacity = 1;
                            fileButtonLabel.style.opacity = 1;
                        }, 100);
                    }, 1000);
                }
            });
    
             // رویداد کلیک بر روی دکمه Reset
             resetBtn.addEventListener('click', async function () {
                await resetDB();
                alert('All saved files have been reset.');
                window.location.reload();
            });

            // رویداد انتخاب فایل
            fileInput.addEventListener('change', async function (event) {
                if (event.target.files.length > 0) {
                    const file = event.target.files[0];

                    // اعتبارسنجی حجم فایل
                    if (file.size > maxFileSize) {
                        showError('File size exceeds the allowed limit.');
                        return;
                    }

                    // اعتبارسنجی نام فایل
                    const allowedFileNames = ['unfollowers.html', 'unfollowers(2).html']; // نام‌های مجاز
                    if (!allowedFileNames.includes(file.name)) {
                        showError('Only files received from the robot are acceptable!');
                        return;
                    }

                    // نمایش لودینگ و تاریک کردن بک‌گراند
                    loadingOverlay.style.display = 'block';
                    loadingSection.style.display = 'flex';

                    const reader = new FileReader();

                    reader.onload = async function (e) {
                        const fileContent = e.target.result;

                        // شبیه‌سازی یک تأخیر برای تست لودینگ
                        await new Promise(resolve => setTimeout(resolve, 2000));

                        await saveFileToDB(fileContent);

                        // مخفی کردن لودینگ و تاریک کردن بک‌گراند
                        loadingOverlay.style.display = 'none';
                        loadingSection.style.display = 'none';

                        // نمایش فایل
                        showFile(fileContent);
                    };

                    reader.onerror = function () {
                        alert('Error reading file. Please try again.');
                        loadingOverlay.style.display = 'none';
                        loadingSection.style.display = 'none';
                    };

                    reader.readAsText(file);
                }
            });

            // تابع نمایش فایل
            function showFile(fileContent) {
                document.open();
                document.write(fileContent);
                document.close();

                // اضافه کردن دکمه Back
                const backButton = document.createElement('button');
                backButton.textContent = 'Back';
                backButton.style.position = 'fixed';
                backButton.style.bottom = '20px';
                backButton.style.right = '20px';
                backButton.style.backgroundColor = '#ff8000';
                backButton.style.color = 'white';
                backButton.style.padding = '10px 20px';
                backButton.style.border = 'none';
                backButton.style.borderRadius = '5px';
                backButton.style.cursor = 'pointer';
                backButton.style.zIndex = '1000';
                backButton.style.transition = 'opacity 0.3s ease';
                backButton.onclick = function () {
                    window.location.reload();
                };
                document.body.appendChild(backButton);
            }

            // ایجاد برف‌ها
            function createSnowflakes(count) {
                const container = document.body;
                for (let i = 0; i < count; i++) {
                    const snowflake = document.createElement('div');
                    snowflake.classList.add('snowflake');
                    snowflake.style.left = `${Math.random() * 100}vw`;
                    snowflake.style.animationDuration = `${Math.random() * 5 + 5}s`;
                    snowflake.style.fontSize = `${Math.random() * 3 + 2}px`;
                    snowflake.style.setProperty('--x', Math.random() * 2 - 1);
                    snowflake.innerHTML = '&#8226;';
                    container.appendChild(snowflake);
                }
            }
        });
    </script>
</body>
</html>
